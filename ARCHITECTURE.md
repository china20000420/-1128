# ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**å¤§æ¨¡å‹è®­ç»ƒæ•°æ®ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ**ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œä¸ºå¤§æ¨¡å‹æ•°æ®æŠ€æœ¯å®éªŒå®¤çš„è®­ç»ƒæ•°æ®ç®¡ç†æä¾›å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

1. **å¤šç§Ÿæˆ·éš”ç¦»**ï¼šæ¯ä¸ªè®­ç»ƒè®¡åˆ’ä½¿ç”¨ç‹¬ç«‹çš„SQLiteæ•°æ®åº“ï¼Œäº’ä¸å¹²æ‰°
2. **å®æ—¶åŒæ­¥**ï¼šå‰ç«¯æ“ä½œå®æ—¶ä¿å­˜åˆ°åç«¯æ•°æ®åº“ï¼Œæ— éœ€æ‰‹åŠ¨ä¿å­˜
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ†é¡µåŠ è½½ã€å•è¡Œæ“ä½œã€ç´¢å¼•ä¼˜åŒ–ï¼Œæ”¯æŒå¤§è§„æ¨¡æ•°æ®
4. **ç”¨æˆ·å‹å¥½**ï¼šExcelé›†æˆã€å¯è§†åŒ–å›¾è¡¨ã€æƒé™ç®¡ç†

### æŠ€æœ¯äº®ç‚¹

- âœ… **å¤šæ•°æ®åº“æ¶æ„**ï¼šä¸»æ•°æ®åº“ + å¤šä¸ªè®¡åˆ’æ•°æ®åº“
- âœ… **RESTful API**ï¼šæ ‡å‡†åŒ–æ¥å£è®¾è®¡
- âœ… **JWTè®¤è¯**ï¼šå®‰å…¨çš„ç”¨æˆ·è®¤è¯æœºåˆ¶
- âœ… **è‡ªåŠ¨åˆ·æ–°**ï¼šå¯è§†åŒ–é¡µé¢30ç§’è‡ªåŠ¨æ›´æ–°
- âœ… **Excelæ— ç¼é›†æˆ**ï¼šæ¨¡æ¿å¯¼å…¥å¯¼å‡ºï¼Œæ ¼å¼ä¿ç•™

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æµè§ˆå™¨ (Browser)                             â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              React å‰ç«¯åº”ç”¨ (Port 3000)                      â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Pages   â”‚  â”‚Componentsâ”‚  â”‚  Utils   â”‚  â”‚  Assets  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Home   â”‚  â”‚ â€¢ Layout â”‚  â”‚ â€¢ auth.jsâ”‚  â”‚ â€¢ styles â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Plan   â”‚  â”‚ â€¢ Table  â”‚  â”‚ â€¢ http   â”‚  â”‚ â€¢ images â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Stage  â”‚  â”‚ â€¢ Charts â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Visual â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚          Ant Design + Recharts + XLSX                       â”‚ â”‚
â”‚  â”‚          React Router + Axios                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTP/HTTPS
                             â”‚ RESTful API (JSON)
                             â”‚ JWT Token Authentication
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               FastAPI åç«¯æœåŠ¡ (Port 5000)                       â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    API è·¯ç”±å±‚                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  /auth   â”‚  â”‚  /plans  â”‚  â”‚ /stages  â”‚  â”‚  /visual â”‚  â”‚ â”‚
â”‚  â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ login  â”‚  â”‚ â€¢ create â”‚  â”‚ â€¢ update â”‚  â”‚ â€¢ stats  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ logout â”‚  â”‚ â€¢ update â”‚  â”‚ â€¢ delete â”‚  â”‚ â€¢ charts â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               ä¸šåŠ¡é€»è¾‘å±‚ (main.py)                           â”‚ â”‚
â”‚  â”‚  â€¢ è¯·æ±‚éªŒè¯ (Pydantic)                                       â”‚ â”‚
â”‚  â”‚  â€¢ æƒé™æ£€æŸ¥ (JWT + is_admin)                                â”‚ â”‚
â”‚  â”‚  â€¢ æ•°æ®å¤„ç† (JSONåºåˆ—åŒ–/ååºåˆ—åŒ–)                           â”‚ â”‚
â”‚  â”‚  â€¢ Tokenè®¡ç®— (è‡ªåŠ¨æ±‚å’Œ)                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             ORM å±‚ (SQLAlchemy)                              â”‚ â”‚
â”‚  â”‚  â€¢ models.py (æ•°æ®æ¨¡å‹å®šä¹‰)                                 â”‚ â”‚
â”‚  â”‚  â€¢ database.py (è¿æ¥ç®¡ç†)                                   â”‚ â”‚
â”‚  â”‚  â€¢ MainBase / PlanBase                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ SQL
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®æŒä¹…åŒ–å±‚ (SQLite)                         â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   main.db        â”‚         â”‚    databases/                 â”‚ â”‚
â”‚  â”‚   (ä¸»æ•°æ®åº“)      â”‚         â”‚    (è®¡åˆ’æ•°æ®åº“ç›®å½•)            â”‚ â”‚
â”‚  â”‚                  â”‚         â”‚                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ users      â”‚ â”‚         â”‚  â”‚ 72b.db  â”‚  â”‚plan_a.dbâ”‚    â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ id       â”‚ â”‚         â”‚  â”‚         â”‚  â”‚         â”‚    â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ username â”‚ â”‚         â”‚  â”‚ stages  â”‚  â”‚ stages  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ password â”‚ â”‚         â”‚  â”‚ rows    â”‚  â”‚ rows    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ is_admin â”‚ â”‚         â”‚  â”‚ details â”‚  â”‚ details â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                  â”‚         â”‚                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚       ... æ›´å¤šè®¡åˆ’æ•°æ®åº“        â”‚ â”‚
â”‚  â”‚  â”‚ plans      â”‚ â”‚         â”‚                                â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ id       â”‚ â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚  â”‚ â€¢ name     â”‚ â”‚                                             â”‚
â”‚  â”‚  â”‚ â€¢ desc     â”‚ â”‚                                             â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ å‰ç«¯æ¶æ„

### æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **React** | 18.2.0 | UIæ¡†æ¶ï¼Œä½¿ç”¨Hooksç®¡ç†çŠ¶æ€ |
| **Vite** | 5.0.8 | æ„å»ºå·¥å…·ï¼Œå¿«é€Ÿå¼€å‘ä½“éªŒ |
| **React Router** | 6.20.1 | å®¢æˆ·ç«¯è·¯ç”±ç®¡ç† |
| **Ant Design** | 5.12.5 | ä¼ä¸šçº§UIç»„ä»¶åº“ |
| **Recharts** | 3.5.0 | æ•°æ®å¯è§†åŒ–å›¾è¡¨ |
| **Axios** | 1.6.2 | HTTPè¯·æ±‚å®¢æˆ·ç«¯ |
| **SheetJS (xlsx)** | 0.18.5 | Excelæ–‡ä»¶è¯»å†™ |

### ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ pages/                    # é¡µé¢ç»„ä»¶ï¼ˆ6ä¸ªä¸»è¦é¡µé¢ï¼‰
â”‚   â”œâ”€â”€ Home.jsx              # é¦–é¡µ - è®­ç»ƒè®¡åˆ’åˆ—è¡¨
â”‚   â”œâ”€â”€ PlanDetail.jsx        # è®¡åˆ’è¯¦æƒ… - æ¦‚è§ˆè¡¨
â”‚   â”œâ”€â”€ StageDetail.jsx       # Stageè¯¦æƒ… - ç±»åˆ«ç®¡ç†
â”‚   â”œâ”€â”€ CategoryDetail.jsx    # å­ç±»åˆ«è¯¦æƒ… - æ•°æ®è¡¨
â”‚   â”œâ”€â”€ Visualization.jsx     # æ•°æ®å¯è§†åŒ–åˆ†æ
â”‚   â””â”€â”€ Login.jsx             # ç”¨æˆ·ç™»å½•
â”œâ”€â”€ components/               # å¯å¤ç”¨ç»„ä»¶ï¼ˆç›®å‰è¾ƒå°‘ï¼‰
â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ auth.js               # è®¤è¯å·¥å…·ï¼ˆtokenã€æƒé™æ£€æŸ¥ï¼‰
â”œâ”€â”€ App.jsx                   # ä¸»åº”ç”¨ï¼ˆè·¯ç”±+å·¦ä¾§å¯¼èˆª+å¸ƒå±€ï¼‰
â””â”€â”€ main.jsx                  # Reactå…¥å£æ–‡ä»¶
```

### é¡µé¢è¯¦è§£

#### 1. Home.jsx - é¦–é¡µ

**åŠŸèƒ½**ï¼š
- å±•ç¤ºæ‰€æœ‰è®­ç»ƒè®¡åˆ’çš„å¡ç‰‡åˆ—è¡¨
- ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤è®¡åˆ’
- ç‚¹å‡»å¡ç‰‡è¿›å…¥è®¡åˆ’è¯¦æƒ…é¡µ

**æ ¸å¿ƒçŠ¶æ€**ï¼š
```javascript
const [plans, setPlans] = useState([])        // è®¡åˆ’åˆ—è¡¨
const [modalVisible, setModalVisible] = useState(false)  // æ¨¡æ€æ¡†æ˜¾ç¤º
const [editingPlan, setEditingPlan] = useState(null)     // æ­£åœ¨ç¼–è¾‘çš„è®¡åˆ’
```

**å…³é”®API**ï¼š
- `GET /api/plans` - è·å–æ‰€æœ‰è®¡åˆ’
- `POST /api/plans` - åˆ›å»ºæ–°è®¡åˆ’
- `PUT /api/plans/{id}` - æ›´æ–°è®¡åˆ’ä¿¡æ¯
- `DELETE /api/plans/{id}` - åˆ é™¤è®¡åˆ’

**äº¤äº’é€»è¾‘**ï¼š
1. ç”¨æˆ·ç‚¹å‡»"åˆ›å»ºæ–°è®¡åˆ’" â†’ æ‰“å¼€æ¨¡æ€æ¡†
2. å¡«å†™è®¡åˆ’åç§°å’Œæè¿° â†’ æäº¤è¡¨å•
3. å‰ç«¯è°ƒç”¨POSTæ¥å£ â†’ åç«¯åˆ›å»ºæ•°æ®åº“
4. åˆ·æ–°è®¡åˆ’åˆ—è¡¨ â†’ è§¦å‘`plansChanged`äº‹ä»¶æ›´æ–°å·¦ä¾§å¯¼èˆª

#### 2. PlanDetail.jsx - è®¡åˆ’è¯¦æƒ…ï¼ˆæ¦‚è§ˆè¡¨ï¼‰

**åŠŸèƒ½**ï¼š
- æ˜¾ç¤ºè®¡åˆ’çš„æ‰€æœ‰Stageï¼Œä»¥æŠ˜å é¢æ¿å½¢å¼å±•ç¤º
- æ¯ä¸ªStageæœ‰ä¸€ä¸ªæ¦‚è§ˆè¡¨ï¼ŒåŒ…å«13åˆ—æ•°æ®
- æ”¯æŒExcelå¯¼å…¥/å¯¼å‡ºã€å•å…ƒæ ¼ç¼–è¾‘ã€åˆå¹¶å•å…ƒæ ¼
- è‡ªåŠ¨ä¿å­˜ï¼ˆ500msé˜²æŠ–ï¼‰

**æ ¸å¿ƒçŠ¶æ€**ï¼š
```javascript
const [stages, setStages] = useState({})          // Stageæ•°æ®ï¼Œkeyä¸ºstageå
const [stagesList, setStagesList] = useState([])  // Stageåˆ—è¡¨
const [selectedRows, setSelectedRows] = useState({})     // é€‰ä¸­çš„è¡Œ
const [selectedCells, setSelectedCells] = useState({})   // é€‰ä¸­çš„å•å…ƒæ ¼
const [editingCell, setEditingCell] = useState(null)     // æ­£åœ¨ç¼–è¾‘çš„å•å…ƒæ ¼
```

**æ•°æ®ç»“æ„**ï¼š
```javascript
stages = {
  'stage1': {
    rows: [
      {
        key: 1,
        category: 'ç±»åˆ«01',
        subcategory: 'å­ç±»åˆ«01',
        total_tokens: '1000000',
        sample_ratio: '50%',
        cumulative_ratio: '50%',
        sample_tokens: '500000',
        category_ratio: '10%',
        part1: 'xxx',
        part2: 'xxx',
        part3: 'xxx',
        part4: 'xxx',
        part5: 'xxx',
        note: 'å¤‡æ³¨'
      },
      // ... æ›´å¤šè¡Œ
    ],
    merges: [
      { row: 0, col: 0, rowspan: 2, colspan: 1 },  // åˆå¹¶ä¿¡æ¯
      // ... æ›´å¤šåˆå¹¶
    ]
  },
  'stage2': { ... }
}
```

**Excelå¯¼å‡º**ï¼š
- æ–‡ä»¶åæ ¼å¼ï¼š`è®¡åˆ’å_Stageå_æ¦‚è§ˆè¡¨.xlsx`
- åŒ…å«æ‰€æœ‰13åˆ—æ•°æ®
- ä½¿ç”¨XLSX.writeFile()ç›´æ¥è§¦å‘æµè§ˆå™¨ä¸‹è½½

**è‡ªåŠ¨ä¿å­˜æœºåˆ¶**ï¼š
```javascript
useEffect(() => {
  if (autoSaveTimer.current) clearTimeout(autoSaveTimer.current)
  autoSaveTimer.current = setTimeout(() => {
    saveData(true)  // é™é»˜ä¿å­˜
  }, 500)  // 500msé˜²æŠ–
}, [description, stages])
```

#### 3. StageDetail.jsx - Stageè¯¦æƒ…ï¼ˆç±»åˆ«ç®¡ç†ï¼‰

**åŠŸèƒ½**ï¼š
- ç®¡ç†äºŒçº§åˆ†ç±»ç»“æ„ï¼ˆä¸€çº§ç±»åˆ« â†’ äºŒçº§ç±»åˆ«ï¼‰
- æ˜¾ç¤ºæ¯ä¸ªç±»åˆ«çš„Tokenç»Ÿè®¡ï¼ˆDST/AUTï¼‰
- ç‚¹å‡»äºŒçº§ç±»åˆ«è¿›å…¥æ•°æ®è¡¨é¡µé¢

**æ ¸å¿ƒçŠ¶æ€**ï¼š
```javascript
const [categories, setCategories] = useState([])      // ç±»åˆ«æ•°ç»„
const [description, setDescription] = useState('')    // Stageæè¿°
```

**æ•°æ®ç»“æ„**ï¼š
```javascript
categories = [
  {
    id: 1702345678901,  // æ—¶é—´æˆ³ç”Ÿæˆçš„å”¯ä¸€ID
    name: 'æ•°å­¦æ¨ç†',
    subcategories: [
      {
        id: 1702345678902,
        name: 'åŸºç¡€é¢˜å‹',
        tokenCountTotal: '1000000.50',    // æ•°æ®é›†æ€»Token
        actualTokenTotal: '800000.25'      // å®é™…ä½¿ç”¨Token
      },
      {
        id: 1702345678903,
        name: 'å¤æ‚é¢˜å‹',
        tokenCountTotal: '2000000.75',
        actualTokenTotal: '1600000.50'
      }
    ],
    tokenCountTotal: '3000001.25',   // ä¸€çº§ç±»åˆ«æ€»è®¡
    actualTokenTotal: '2400000.75'
  },
  // ... æ›´å¤šä¸€çº§ç±»åˆ«
]
```

**Tokenç»Ÿè®¡é€»è¾‘**ï¼š
- ä»åç«¯è·å–æ¯ä¸ªäºŒçº§ç±»åˆ«çš„Tokenæ€»é‡
- å‰ç«¯æ±‡æ€»è®¡ç®—ä¸€çº§ç±»åˆ«çš„æ€»è®¡
- å®æ—¶æ›´æ–°æ˜¾ç¤º

#### 4. CategoryDetail.jsx - æ•°æ®è¡¨é¡µé¢

**åŠŸèƒ½**ï¼š
- å±•ç¤ºæŸä¸ªäºŒçº§ç±»åˆ«çš„æ‰€æœ‰æ•°æ®ï¼ˆåˆ†é¡µæ˜¾ç¤ºï¼‰
- Excelå¯¼å…¥/å¯¼å‡º
- åŒå‡»ç¼–è¾‘å•å…ƒæ ¼ï¼Œå®æ—¶ä¿å­˜
- è¡Œå±•å¼€æŸ¥çœ‹å®Œæ•´å†…å®¹
- æ‰¹é‡åˆ é™¤

**æ ¸å¿ƒçŠ¶æ€**ï¼š
```javascript
const [rows, setRows] = useState([])                  // å½“å‰é¡µæ•°æ®
const [total, setTotal] = useState(0)                 // æ€»è¡Œæ•°
const [currentPage, setCurrentPage] = useState(1)     // å½“å‰é¡µç 
const [pageSize, setPageSize] = useState(20)          // æ¯é¡µæ¡æ•°
const [tokenCountTotal, setTokenCountTotal] = useState('0')   // DST
const [actualTokenTotal, setActualTokenTotal] = useState('0') // AUT
```

**åˆ†é¡µæœºåˆ¶**ï¼š
```javascript
// åŠ è½½æŒ‡å®šé¡µçš„æ•°æ®
const loadData = async (page = 1) => {
  const res = await axios.get(
    `/api/plans/${planName}/stages/${stageName}/categories/${categoryName}/${subcategoryName}`,
    { params: { page, page_size: pageSize } }
  )
  setRows(res.data.rows)           // å½“å‰é¡µæ•°æ®
  setTotal(res.data.total)         // æ€»æ¡æ•°
  setTokenCountTotal(res.data.tokenCountTotal)
  setActualTokenTotal(res.data.actualTokenTotal)
}
```

**å•è¡Œç¼–è¾‘**ï¼š
- åŒå‡»å•å…ƒæ ¼ â†’ è¿›å…¥ç¼–è¾‘æ¨¡å¼
- ä¿®æ”¹å†…å®¹ â†’ å¤±å»ç„¦ç‚¹
- è‡ªåŠ¨è°ƒç”¨ `PATCH /.../row` æ¥å£
- åç«¯æ›´æ–°è¯¥è¡Œæ•°æ®å¹¶é‡æ–°è®¡ç®—Token
- å‰ç«¯æ›´æ–°Tokenæ˜¾ç¤º

**Excelå¯¼å…¥æ ¼å¼ä¿ç•™**ï¼š
```javascript
const workbook = XLSX.read(data, {
  type: 'array',
  raw: false,        // ä¸ä½¿ç”¨åŸå§‹å€¼
  cellText: true     // ä¿ç•™æ–‡æœ¬æ ¼å¼
})
// è¿™æ · "100%" ä¸ä¼šå˜æˆ 1
```

**Excelå¯¼å‡º**ï¼š
- æ–‡ä»¶åæ ¼å¼ï¼š`è®¡åˆ’å_Stageå_ä¸€çº§ç±»åˆ«_äºŒçº§ç±»åˆ«_æ•°æ®è¡¨.xlsx`
- å¯¼å‡ºæ‰€æœ‰æ•°æ®ï¼ˆä¸åˆ†é¡µï¼‰ï¼Œå‚æ•°ï¼š`page_size=999999`

#### 5. Visualization.jsx - æ•°æ®å¯è§†åŒ–

**åŠŸèƒ½**ï¼š
- é€‰æ‹©è®¡åˆ’åå±•ç¤ºå¤šç»´åº¦ç»Ÿè®¡
- è‡ªåŠ¨åˆ·æ–°ï¼ˆ30ç§’é—´éš”ï¼‰
- ä¸‰ç§ç©ºçŠ¶æ€å¤„ç†

**æ ¸å¿ƒçŠ¶æ€**ï¼š
```javascript
const [loading, setLoading] = useState(true)          // åŠ è½½çŠ¶æ€
const [plans, setPlans] = useState([])                // è®¡åˆ’åˆ—è¡¨
const [selectedPlan, setSelectedPlan] = useState(null)  // é€‰ä¸­çš„è®¡åˆ’
const [statsData, setStatsData] = useState(null)      // ç»Ÿè®¡æ•°æ®
```

**è‡ªåŠ¨åˆ·æ–°**ï¼š
```javascript
useEffect(() => {
  if (selectedPlan) {
    loadVisualizationData(selectedPlan)

    const interval = setInterval(() => {
      loadVisualizationData(selectedPlan)  // æ¯30ç§’åˆ·æ–°
    }, 30000)

    return () => clearInterval(interval)  // æ¸…ç†å®šæ—¶å™¨
  }
}, [selectedPlan])
```

**ä¸‰ç§çŠ¶æ€**ï¼š
1. **Loading**ï¼šæ˜¾ç¤ºSpinåŠ è½½åŠ¨ç”»
2. **æ— è®¡åˆ’**ï¼šæ˜¾ç¤º"æš‚æ— è®­ç»ƒè®¡åˆ’ï¼Œè¯·å…ˆåˆ›å»ºè®¡åˆ’"
3. **æ— æ•°æ®**ï¼šæ˜¾ç¤º"è¯¥è®¡åˆ’æš‚æ— é˜¶æ®µæ•°æ®"ï¼ˆä¿ç•™è®¡åˆ’é€‰æ‹©å™¨ï¼‰

**å›¾è¡¨ç±»å‹**ï¼š
| å›¾è¡¨ | ç»„ä»¶ | æ•°æ®æº |
|------|------|--------|
| æ¦‚è§ˆå¡ç‰‡ | Statistic | overview |
| é˜¶æ®µTokenæŸ±çŠ¶å›¾ | BarChart | stageStats |
| é˜¶æ®µæ•°æ®é›†æŸ±çŠ¶å›¾ | BarChart | stageStats |
| ä¸€çº§ç±»åˆ«é¥¼å›¾ | PieChart | categoryDistribution |
| Tokenè¶‹åŠ¿æŠ˜çº¿å›¾ | LineChart | tokenTrends |
| ä¸€çº§ç±»åˆ«è¡¨æ ¼ | Table | categoryStats |
| äºŒçº§ç±»åˆ«Top 10 | BarChart (horizontal) | subcategoryStats |

**é¥¼å›¾ä¼˜åŒ–**ï¼š
```javascript
<Pie
  data={categoryDistribution}
  dataKey="value"
  nameKey="name"
  cx="50%"
  cy="50%"
  outerRadius={120}
  label={false}  // éšè—æ ‡ç­¾ï¼Œé¿å…é‡å 
>
```
- æ ‡ç­¾é€šè¿‡Legendå’ŒTooltipæ˜¾ç¤º
- é¼ æ ‡æ‚¬åœæŸ¥çœ‹è¯¦æƒ…

#### 6. Login.jsx - ç™»å½•é¡µé¢

**åŠŸèƒ½**ï¼š
- ç”¨æˆ·åå¯†ç ç™»å½•
- JWT Tokenç®¡ç†
- è‡ªåŠ¨è·³è½¬

**è®¤è¯æµç¨‹**ï¼š
1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
2. å‰ç«¯è°ƒç”¨ `POST /api/auth/login`
3. åç«¯éªŒè¯æˆåŠŸï¼Œè¿”å›JWT Token
4. å‰ç«¯ä¿å­˜Tokenåˆ°localStorage
5. è·³è½¬åˆ°é¦–é¡µ

### è·¯ç”±è®¾è®¡

```javascript
// App.jsx
<Routes>
  <Route path="/login" element={<Login />} />
  <Route path="/*" element={<ProtectedRoute><MainLayout /></ProtectedRoute>} />
</Routes>

// MainLayoutä¸­çš„Routes
<Routes>
  <Route path="/" element={<Home />} />
  <Route path="/visualization" element={<Visualization />} />
  <Route path="/plan/:planName" element={<PlanDetail />} />
  <Route path="/plan/:planName/:stageName" element={<StageDetail />} />
  <Route path="/plan/:planName/:stageName/:categoryName/:subcategoryName"
         element={<CategoryDetail />} />
</Routes>
```

**è·¯ç”±å‚æ•°**ï¼š
- `:planName` - è®¡åˆ’åç§°ï¼ˆå¦‚ `72b`ï¼‰
- `:stageName` - Stageåç§°ï¼ˆå¦‚ `stage1`ï¼‰
- `:categoryName` - ä¸€çº§ç±»åˆ«ï¼ˆURLç¼–ç ï¼‰
- `:subcategoryName` - äºŒçº§ç±»åˆ«ï¼ˆURLç¼–ç ï¼‰

### å·¦ä¾§å¯¼èˆªæ 

**è®¾è®¡ç‰¹ç‚¹**ï¼š
- å›ºå®šåœ¨å·¦ä¾§ï¼Œå¯æŠ˜å 
- åŠ¨æ€ç”Ÿæˆè®¡åˆ’å’ŒStageèœå•
- æ”¯æŒæ»šåŠ¨ï¼ˆå½“å†…å®¹è¶…å‡ºæ—¶ï¼‰
- é¡¶éƒ¨æ˜¾ç¤ºå®éªŒå®¤åç§°
- åº•éƒ¨æ˜¾ç¤ºç‰ˆæƒä¿¡æ¯

**èœå•ç»“æ„**ï¼š
```javascript
const menuItems = [
  {
    key: '/',
    icon: <HomeOutlined />,
    label: 'é¦–é¡µ'
  },
  {
    key: '/visualization',
    icon: <BarChartOutlined />,
    label: 'æ•°æ®å¯è§†åŒ–'
  },
  // åŠ¨æ€ç”Ÿæˆçš„è®¡åˆ’èœå•
  ...plans.map(plan => ({
    key: `plan-${plan.key}`,
    icon: <DatabaseOutlined />,
    label: plan.name,
    children: [
      { key: `/plan/${plan.key}`, label: 'è®¡åˆ’æ¦‚è§ˆ' },
      // åŠ¨æ€ç”Ÿæˆçš„Stageå­èœå•
      ...plan.stages.map(stageKey => ({
        key: `/plan/${plan.key}/${stageKey}`,
        label: stageKey.toUpperCase()
      }))
    ]
  }))
]
```

**æ»šåŠ¨å®ç°**ï¼š
```javascript
<div style={{
  height: 'calc(100vh - 100px - 70px)',  // è§†å£é«˜åº¦ - å¤´éƒ¨ - åº•éƒ¨
  overflowY: 'auto',
  overflowX: 'hidden'
}}>
  <Menu ... />
</div>
```

---

## âš™ï¸ åç«¯æ¶æ„

### æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **FastAPI** | 0.104.1 | é«˜æ€§èƒ½Webæ¡†æ¶ |
| **Uvicorn** | 0.24.0 | ASGIæœåŠ¡å™¨ |
| **SQLAlchemy** | 2.0.23 | ORMæ¡†æ¶ |
| **SQLite** | 3.x | è½»é‡çº§æ•°æ®åº“ |
| **Passlib** | 1.7.4 | å¯†ç åŠ å¯†ï¼ˆbcryptï¼‰ |
| **Python-Jose** | 3.3.0 | JWT Tokenç”Ÿæˆ |

### ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ main.py              # APIè·¯ç”±å’Œä¸šåŠ¡é€»è¾‘ï¼ˆæ ¸å¿ƒæ–‡ä»¶ï¼Œ800+è¡Œï¼‰
â”œâ”€â”€ models.py            # æ•°æ®åº“æ¨¡å‹å®šä¹‰ï¼ˆ5ä¸ªæ¨¡å‹ï¼‰
â”œâ”€â”€ database.py          # æ•°æ®åº“è¿æ¥å’Œå¤šæ•°æ®åº“ç®¡ç†
â”œâ”€â”€ auth.py              # JWTè®¤è¯å’Œå¯†ç åŠ å¯†
â”œâ”€â”€ init_db.py           # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ requirements.txt     # Pythonä¾èµ–åˆ—è¡¨
â”œâ”€â”€ main.db              # ä¸»æ•°æ®åº“ï¼ˆç”¨æˆ·+è®¡åˆ’ï¼‰
â””â”€â”€ databases/           # è®¡åˆ’æ•°æ®åº“ç›®å½•
    â”œâ”€â”€ 72b.db
    â”œâ”€â”€ plan_a.db
    â””â”€â”€ ... (æ›´å¤š)
```

### æ•°æ®åº“æ¶æ„

#### å¤šæ•°æ®åº“è®¾è®¡

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **ä¸»æ•°æ®åº“**ï¼ˆmain.dbï¼‰ï¼šå­˜å‚¨ç”¨æˆ·å’Œè®¡åˆ’åˆ—è¡¨
- **è®¡åˆ’æ•°æ®åº“**ï¼ˆdatabases/{plan_name}.dbï¼‰ï¼šæ¯ä¸ªè®¡åˆ’ç‹¬ç«‹å­˜å‚¨

**ä¼˜åŠ¿**ï¼š
1. **éš”ç¦»æ€§**ï¼šè®¡åˆ’ä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œåˆ é™¤ä¸€ä¸ªè®¡åˆ’ä¸å½±å“å…¶ä»–
2. **å¯æ‰©å±•æ€§**ï¼šå•ä¸ªè®¡åˆ’æ•°æ®é‡å¤§æ—¶ä¸å½±å“ç³»ç»Ÿæ€§èƒ½
3. **æ˜“ç»´æŠ¤**ï¼šå¯å•ç‹¬å¤‡ä»½ã€æ¢å¤ã€è¿ç§»æŸä¸ªè®¡åˆ’
4. **æ˜“è°ƒè¯•**ï¼šæ•°æ®åº“æ–‡ä»¶ç‹¬ç«‹ï¼Œé—®é¢˜å®šä½æ›´å®¹æ˜“

**å®ç°æœºåˆ¶**ï¼š

```python
# database.py

# ä¸»æ•°æ®åº“
MAIN_DATABASE_URL = "sqlite:///./main.db"
main_engine = create_engine(MAIN_DATABASE_URL)
MainBase = declarative_base()  # ç”¨äºUserå’ŒPlanæ¨¡å‹

# è®¡åˆ’æ•°æ®åº“ç›®å½•
DATABASES_DIR = "./databases"
PlanBase = declarative_base()  # ç”¨äºStageã€TableRowã€CategoryDetailæ¨¡å‹

# ç¼“å­˜è®¡åˆ’æ•°æ®åº“çš„engine
_plan_engines = {}

def get_plan_engine(plan_name: str):
    """è·å–æˆ–åˆ›å»ºè®¡åˆ’æ•°æ®åº“engine"""
    if plan_name not in _plan_engines:
        db_path = os.path.join(DATABASES_DIR, f"{plan_name.lower()}.db")
        engine = create_engine(f"sqlite:///{db_path}")
        PlanBase.metadata.create_all(bind=engine)  # è‡ªåŠ¨åˆ›å»ºè¡¨
        _plan_engines[plan_name] = engine
    return _plan_engines[plan_name]
```

#### æ•°æ®åº“æ¨¡å‹

**ä¸»æ•°æ®åº“æ¨¡å‹ï¼ˆMainBaseï¼‰**ï¼š

```python
# models.py

class User(MainBase):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True, index=True)
    username = Column(String, unique=True, index=True)
    hashed_password = Column(String)
    is_admin = Column(Boolean, default=False)

class Plan(MainBase):
    __tablename__ = "plans"
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, unique=True, index=True)
    description = Column(Text, default="")
```

**è®¡åˆ’æ•°æ®åº“æ¨¡å‹ï¼ˆPlanBaseï¼‰**ï¼š

```python
class Stage(PlanBase):
    __tablename__ = "stages"
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, index=True)
    description = Column(Text, default="")
    stage_order = Column(Integer, default=0)
    rows = relationship("TableRow", back_populates="stage")
    _merges = Column("merges", Text, default="[]")      # JSONå­—æ®µ
    _categories = Column("categories", Text, default="[]")  # JSONå­—æ®µ

    @property
    def merges(self):
        return json.loads(self._merges)

    @merges.setter
    def merges(self, value):
        self._merges = json.dumps(value)

class TableRow(PlanBase):
    __tablename__ = "table_rows"
    id = Column(Integer, primary_key=True, index=True)
    stage_id = Column(Integer, ForeignKey("stages.id"))
    stage = relationship("Stage", back_populates="rows")
    category = Column(String, default="")
    subcategory = Column(String, default="")
    total_tokens = Column(String, default="")
    sample_ratio = Column(String, default="")
    cumulative_ratio = Column(String, default="")
    sample_tokens = Column(String, default="")
    category_ratio = Column(String, default="")
    part1 = Column(String, default="")
    part2 = Column(String, default="")
    part3 = Column(String, default="")
    part4 = Column(String, default="")
    part5 = Column(String, default="")
    note = Column(String, default="")
    row_order = Column(Integer, default=0)

class CategoryDetail(PlanBase):
    __tablename__ = "category_details"
    id = Column(Integer, primary_key=True, index=True)
    stage_id = Column(Integer, ForeignKey("stages.id"), index=True)
    category_name = Column(String, index=True)
    subcategory_name = Column(String, index=True)
    description = Column(Text, default="")
    _rows = Column("rows", Text, default="[]")  # JSONæ•°ç»„ï¼Œå­˜å‚¨æ•°æ®è¡Œ
    token_count_total = Column(String, default="0")
    actual_token_total = Column(String, default="0")

    @property
    def rows(self):
        return json.loads(self._rows)

    @rows.setter
    def rows(self, value):
        self._rows = json.dumps(value)
```

**JSONå­—æ®µè¯´æ˜**ï¼š
- SQLiteä¸æ”¯æŒåŸç”ŸJSONç±»å‹
- ä½¿ç”¨TEXTå­—æ®µå­˜å‚¨JSONå­—ç¬¦ä¸²
- é€šè¿‡@propertyè£…é¥°å™¨å®ç°è‡ªåŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ–
- ä¼˜ç‚¹ï¼šçµæ´»å­˜å‚¨å¤æ‚æ•°æ®ç»“æ„

**ç´¢å¼•ä¼˜åŒ–**ï¼š
- æ‰€æœ‰ä¸»é”®è‡ªåŠ¨ç´¢å¼•
- usernameã€plan nameæ·»åŠ å”¯ä¸€ç´¢å¼•
- stage_idã€category_nameã€subcategory_nameæ·»åŠ ç´¢å¼•
- æå‡æŸ¥è¯¢æ€§èƒ½

### APIè®¾è®¡

#### RESTfulé£æ ¼æ¥å£

```
åŸºç¡€è·¯å¾„ï¼šhttp://localhost:5000/api
```

**è®¤è¯ç›¸å…³**ï¼š
```
POST   /auth/login           ç™»å½•ï¼Œè¿”å›JWT Token
POST   /auth/register        æ³¨å†Œæ–°ç”¨æˆ·ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
GET    /auth/me              è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
```

**è®¡åˆ’ç®¡ç†**ï¼š
```
GET    /plans                è·å–æ‰€æœ‰è®¡åˆ’åˆ—è¡¨
POST   /plans                åˆ›å»ºæ–°è®¡åˆ’ï¼ˆéœ€ç®¡ç†å‘˜ï¼‰
PUT    /plans/{id}           æ›´æ–°è®¡åˆ’ä¿¡æ¯ï¼ˆéœ€ç®¡ç†å‘˜ï¼‰
DELETE /plans/{id}           åˆ é™¤è®¡åˆ’ï¼ˆéœ€ç®¡ç†å‘˜ï¼‰
```

**è®¡åˆ’è¯¦æƒ…ï¼ˆæ¦‚è§ˆè¡¨ï¼‰**ï¼š
```
GET    /plan{plan_name}      è·å–è®¡åˆ’çš„æ‰€æœ‰Stageæ•°æ®
POST   /plan{plan_name}      ä¿å­˜è®¡åˆ’çš„æ‰€æœ‰Stageæ•°æ®
```

**Stageç®¡ç†ï¼ˆç±»åˆ«ç»“æ„ï¼‰**ï¼š
```
GET    /plans/{plan}/stages/{stage}/categories
       è·å–Stageçš„ç±»åˆ«ç»“æ„ï¼ˆJSONæ•°ç»„ï¼‰

POST   /plans/{plan}/stages/{stage}/categories
       ä¿å­˜Stageçš„ç±»åˆ«ç»“æ„
```

**æ•°æ®è¡¨ç®¡ç†ï¼ˆåˆ†é¡µ+å•è¡Œæ“ä½œï¼‰**ï¼š
```
GET    /plans/{plan}/stages/{stage}/categories/{cat}/{subcat}
       ?page=1&page_size=20
       è·å–æ•°æ®è¡¨ï¼ˆåˆ†é¡µï¼‰

PATCH  /plans/{plan}/stages/{stage}/categories/{cat}/{subcat}/description
       æ›´æ–°æè¿°

PATCH  /plans/{plan}/stages/{stage}/categories/{cat}/{subcat}/row
       æ›´æ–°æˆ–æ’å…¥å•è¡Œæ•°æ®

DELETE /plans/{plan}/stages/{stage}/categories/{cat}/{subcat}/rows
       æ‰¹é‡åˆ é™¤è¡Œ
```

**å¯è§†åŒ–ç»Ÿè®¡**ï¼š
```
GET    /plans/{plan}/visualization
       è·å–è®¡åˆ’çš„ç»Ÿè®¡æ•°æ®ï¼ˆæ¦‚è§ˆã€å›¾è¡¨ã€è¡¨æ ¼ï¼‰
```

#### åˆ†é¡µå®ç°

**APIæ¥å£**ï¼š
```python
@app.get("/api/plans/{plan_name}/stages/{stage_name}/categories/{category_name}/{subcategory_name}")
def get_category_detail(
    plan_name: str,
    stage_name: str,
    category_name: str,
    subcategory_name: str,
    page: int = 1,
    page_size: int = 20
):
    # 1. è·å–CategoryDetailè®°å½•
    db = get_plan_session(plan_name)
    stage = db.query(models.Stage).filter(models.Stage.name == stage_name).first()
    category_data = db.query(models.CategoryDetail).filter(
        models.CategoryDetail.stage_id == stage.id,
        models.CategoryDetail.category_name == category_name,
        models.CategoryDetail.subcategory_name == subcategory_name
    ).first()

    # 2. ä»JSONå­—æ®µè·å–æ‰€æœ‰è¡Œ
    all_rows = category_data.rows if category_data else []
    total = len(all_rows)

    # 3. åˆ†é¡µåˆ‡ç‰‡
    start = (page - 1) * page_size
    end = start + page_size
    paged_rows = all_rows[start:end]

    # 4. è¿”å›åˆ†é¡µæ•°æ®
    return {
        "rows": paged_rows,
        "total": total,
        "page": page,
        "page_size": page_size,
        "description": category_data.description,
        "tokenCountTotal": category_data.token_count_total,
        "actualTokenTotal": category_data.actual_token_total
    }
```

**ä¼˜åŠ¿**ï¼š
- å‡å°‘æ•°æ®ä¼ è¾“é‡ï¼ˆåªä¼ è¾“20æ¡ï¼‰
- å‰ç«¯æ¸²æŸ“æ›´å¿«ï¼ˆDOMèŠ‚ç‚¹æ›´å°‘ï¼‰
- æ”¯æŒå¤§è§„æ¨¡æ•°æ®ï¼ˆ10ä¸‡+è¡Œï¼‰

#### å•è¡Œæ“ä½œ

**æ›´æ–°å•è¡Œ**ï¼š
```python
class RowUpdateData(BaseModel):
    key: int                       # è¡Œçš„å”¯ä¸€æ ‡è¯†
    hdfs_path: Optional[str] = ""
    obs_fuzzy_path: Optional[str] = ""
    obs_full_path: Optional[str] = ""
    token_count: Optional[str] = ""
    actual_usage: Optional[str] = ""
    actual_token: Optional[str] = ""

@app.patch("/.../row")
def update_row(
    plan_name: str,
    stage_name: str,
    category_name: str,
    subcategory_name: str,
    data: RowUpdateData
):
    # 1. è·å–CategoryDetail
    category_data = query_category_detail(...)

    # 2. æ›´æ–°rowsæ•°ç»„ä¸­çš„æŒ‡å®šè¡Œ
    rows = category_data.rows
    found = False
    for i, row in enumerate(rows):
        if row['key'] == data.key:
            rows[i] = {
                'key': data.key,
                'hdfs_path': data.hdfs_path,
                'obs_fuzzy_path': data.obs_fuzzy_path,
                'obs_full_path': data.obs_full_path,
                'token_count': data.token_count,
                'actual_usage': data.actual_usage,
                'actual_token': data.actual_token
            }
            found = True
            break

    # å¦‚æœæ²¡æ‰¾åˆ°ï¼Œè¯´æ˜æ˜¯æ–°è¡Œï¼Œæ’å…¥
    if not found:
        rows.append({...})

    # 3. ä¿å­˜å›æ•°æ®åº“
    category_data.rows = rows

    # 4. é‡æ–°è®¡ç®—Tokenæ€»é‡
    token_total = sum(float(r.get('token_count', 0) or 0) for r in rows)
    actual_total = sum(float(r.get('actual_token', 0) or 0) for r in rows)
    category_data.token_count_total = str(token_total)
    category_data.actual_token_total = str(actual_total)

    db.commit()

    # 5. è¿”å›æ–°çš„æ€»é‡
    return {
        "tokenCountTotal": str(token_total),
        "actualTokenTotal": str(actual_total)
    }
```

**æ‰¹é‡åˆ é™¤**ï¼š
```python
class RowDeleteData(BaseModel):
    keys: list[int]  # è¦åˆ é™¤çš„è¡Œçš„keyåˆ—è¡¨

@app.delete("/.../rows")
def delete_rows(
    plan_name: str,
    stage_name: str,
    category_name: str,
    subcategory_name: str,
    data: RowDeleteData
):
    category_data = query_category_detail(...)

    # è¿‡æ»¤æ‰è¦åˆ é™¤çš„è¡Œ
    rows = [r for r in category_data.rows if r['key'] not in data.keys]
    category_data.rows = rows

    # é‡æ–°è®¡ç®—Token
    token_total = sum(...)
    actual_total = sum(...)
    category_data.token_count_total = str(token_total)
    category_data.actual_token_total = str(actual_total)

    db.commit()

    return {
        "tokenCountTotal": str(token_total),
        "actualTokenTotal": str(actual_total)
    }
```

### è®¤è¯æœºåˆ¶

#### JWT Tokenæµç¨‹

**ç™»å½•**ï¼š
```python
from passlib.context import CryptContext
from jose import JWTError, jwt
from datetime import datetime, timedelta

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

SECRET_KEY = "your-secret-key-here"  # ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ç¯å¢ƒå˜é‡
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = 60 * 24 * 7  # 7å¤©

@app.post("/api/auth/login")
def login(credentials: UserLogin, db: Session = Depends(get_main_db)):
    # 1. æŸ¥è¯¢ç”¨æˆ·
    user = db.query(models.User).filter(
        models.User.username == credentials.username
    ).first()

    # 2. éªŒè¯å¯†ç 
    if not user or not verify_password(credentials.password, user.hashed_password):
        raise HTTPException(status_code=401, detail="Invalid credentials")

    # 3. ç”ŸæˆJWT Token
    access_token = create_access_token({"sub": user.username})

    # 4. è¿”å›Tokenå’Œç”¨æˆ·ä¿¡æ¯
    return {
        "access_token": access_token,
        "is_admin": user.is_admin
    }

def create_access_token(data: dict):
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt
```

**æƒé™éªŒè¯**ï¼š
```python
from fastapi import Depends, HTTPException
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials

security = HTTPBearer()

def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security),
    db: Session = Depends(get_main_db)
):
    try:
        # è§£ç Token
        payload = jwt.decode(credentials.credentials, SECRET_KEY, algorithms=[ALGORITHM])
        username: str = payload.get("sub")
        if username is None:
            raise HTTPException(status_code=401, detail="Invalid token")
    except JWTError:
        raise HTTPException(status_code=401, detail="Invalid token")

    # æŸ¥è¯¢ç”¨æˆ·
    user = db.query(models.User).filter(models.User.username == username).first()
    if user is None:
        raise HTTPException(status_code=401, detail="User not found")

    return user

def require_admin(current_user: models.User = Depends(get_current_user)):
    if not current_user.is_admin:
        raise HTTPException(status_code=403, detail="Admin access required")
    return current_user
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
@app.post("/api/plans")
def create_plan(
    plan: PlanCreate,
    current_user: models.User = Depends(require_admin)  # éœ€è¦ç®¡ç†å‘˜æƒé™
):
    # åˆ›å»ºè®¡åˆ’çš„é€»è¾‘
    ...
```

---

## ğŸ”„ æ•°æ®æµè¯¦è§£

### 1. ç”¨æˆ·ç™»å½•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æµè§ˆå™¨â”‚                  â”‚åç«¯  â”‚                  â”‚main.db   â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜                  â””â”€â”€â”¬â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                         â”‚                           â”‚
   â”‚  POST /api/auth/login   â”‚                           â”‚
   â”‚  {username, password}   â”‚                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
   â”‚                         â”‚                           â”‚
   â”‚                         â”‚  SELECT * FROM users      â”‚
   â”‚                         â”‚  WHERE username = ?       â”‚
   â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                         â”‚                           â”‚
   â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                         â”‚  User {id, username,      â”‚
   â”‚                         â”‚       hashed_password,    â”‚
   â”‚                         â”‚       is_admin}           â”‚
   â”‚                         â”‚                           â”‚
   â”‚                         â”‚  verify_password()        â”‚
   â”‚                         â”‚  âœ“ å¯†ç æ­£ç¡®               â”‚
   â”‚                         â”‚                           â”‚
   â”‚                         â”‚  create_access_token()    â”‚
   â”‚                         â”‚  âœ“ ç”ŸæˆJWT Token          â”‚
   â”‚                         â”‚                           â”‚
   â”‚  {access_token,         â”‚                           â”‚
   â”‚   is_admin: true}       â”‚                           â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
   â”‚                         â”‚                           â”‚
   â”‚  localStorage.setItem(  â”‚                           â”‚
   â”‚    'token', token)      â”‚                           â”‚
   â”‚  localStorage.setItem(  â”‚                           â”‚
   â”‚    'is_admin', true)    â”‚                           â”‚
   â”‚                         â”‚                           â”‚
   â”‚  navigate('/')          â”‚                           â”‚
   â”‚  è¿›å…¥é¦–é¡µ                â”‚                           â”‚
   â”‚                         â”‚                           â”‚
```

### 2. åˆ›å»ºè®¡åˆ’æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æµè§ˆå™¨â”‚     â”‚åç«¯  â”‚     â”‚main.db   â”‚     â”‚databases/  â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
   â”‚            â”‚              â”‚                  â”‚
   â”‚  ç”¨æˆ·ç‚¹å‡»   â”‚              â”‚                  â”‚
   â”‚ "åˆ›å»ºæ–°è®¡åˆ’"â”‚              â”‚                  â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚  æ‰“å¼€æ¨¡æ€æ¡† â”‚              â”‚                  â”‚
   â”‚  å¡«å†™ä¿¡æ¯ï¼š â”‚              â”‚                  â”‚
   â”‚  name: 72B â”‚              â”‚                  â”‚
   â”‚  desc: xxx â”‚              â”‚                  â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚  POST /api/plans         â”‚                  â”‚
   â”‚  {name, description}     â”‚                  â”‚
   â”‚  Header: Bearer {token}  â”‚                  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚            â”‚ verify JWT   â”‚                  â”‚
   â”‚            â”‚ âœ“ ç®¡ç†å‘˜      â”‚                  â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚            â”‚ INSERT INTO plans               â”‚
   â”‚            â”‚ (name, description)             â”‚
   â”‚            â”‚ VALUES ('72B', 'xxx')           â”‚
   â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚            â”‚ get_plan_engine('72B')          â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚            â”‚ åˆ›å»ºæ–°å¼•æ“ï¼š  â”‚                  â”‚
   â”‚            â”‚ sqlite:///./databases/72b.db    â”‚
   â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚            â”‚ PlanBase.metadata.create_all()  â”‚
   â”‚            â”‚ âœ“ åˆ›å»ºtables:â”‚                  â”‚
   â”‚            â”‚   - stages   â”‚                  â”‚
   â”‚            â”‚   - table_rowsâ”‚                 â”‚
   â”‚            â”‚   - category_details            â”‚
   â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚            â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚            â”‚              â”‚  72b.db å·²åˆ›å»º   â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚  {success: true,          â”‚                  â”‚
   â”‚   plan: {...}}            â”‚                  â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚  message.success()        â”‚                  â”‚
   â”‚  loadPlans()              â”‚                  â”‚
   â”‚  window.dispatchEvent(    â”‚                  â”‚
   â”‚    'plansChanged')        â”‚                  â”‚
   â”‚            â”‚              â”‚                  â”‚
   â”‚  App.jsxç›‘å¬åˆ°äº‹ä»¶        â”‚                  â”‚
   â”‚  é‡æ–°åŠ è½½å¯¼èˆªæ             â”‚                  â”‚
   â”‚  âœ“ æ˜¾ç¤ºæ–°è®¡åˆ’èœå•          â”‚                  â”‚
   â”‚            â”‚              â”‚                  â”‚
```

### 3. æ•°æ®è¡¨ç¼–è¾‘æµç¨‹ï¼ˆåˆ†é¡µ+å•è¡Œæ“ä½œï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æµè§ˆå™¨â”‚              â”‚åç«¯  â”‚              â”‚databases/    â”‚
â”‚      â”‚              â”‚      â”‚              â”‚  72b.db      â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                     â”‚                         â”‚
   â”‚ ç”¨æˆ·è®¿é—®æ•°æ®è¡¨é¡µé¢   â”‚                         â”‚
   â”‚ /plan/72B/stage1/  â”‚                         â”‚
   â”‚   æ•°å­¦/åŸºç¡€é¢˜å‹     â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ GET /.../categories/æ•°å­¦/åŸºç¡€é¢˜å‹             â”‚
   â”‚    ?page=1&page_size=20                      â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ SELECT * FROM category_details â”‚
   â”‚                     â”‚ WHERE stage_id = 1      â”‚
   â”‚                     â”‚   AND category_name = 'æ•°å­¦'   â”‚
   â”‚                     â”‚   AND subcategory_name = 'åŸºç¡€' â”‚
   â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                     â”‚ {id: 1,                 â”‚
   â”‚                     â”‚  _rows: '[{...}, ...]', â”‚
   â”‚                     â”‚  token_count_total: '1M',â”‚
   â”‚                     â”‚  actual_token_total: '800K'}â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ rows = json.loads(_rows)â”‚
   â”‚                     â”‚ total = len(rows) = 500 â”‚
   â”‚                     â”‚ paged = rows[0:20]      â”‚
   â”‚                     â”‚                         â”‚
   â”‚ {rows: [...20æ¡...],â”‚                         â”‚
   â”‚  total: 500,        â”‚                         â”‚
   â”‚  page: 1,           â”‚                         â”‚
   â”‚  tokenCountTotal: '1M',                       â”‚
   â”‚  actualTokenTotal: '800K'}                    â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ æ˜¾ç¤ºç¬¬1é¡µæ•°æ®        â”‚                         â”‚
   â”‚ æ˜¾ç¤ºåˆ†é¡µæ§ä»¶ï¼š1/25é¡µ  â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ ç”¨æˆ·åŒå‡»å•å…ƒæ ¼       â”‚                         â”‚
   â”‚ ä¿®æ”¹token_count     â”‚                         â”‚
   â”‚ ä» "1000" â†’ "2000" â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ PATCH /.../row      â”‚                         â”‚
   â”‚ {key: 123,          â”‚                         â”‚
   â”‚  token_count: '2000'}                         â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ SELECT * FROM category_details â”‚
   â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ rows = json.loads(_rows)â”‚
   â”‚                     â”‚ for i, row in enumerate(rows): â”‚
   â”‚                     â”‚   if row['key'] == 123: â”‚
   â”‚                     â”‚     rows[i]['token_count'] = '2000' â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ _rows = json.dumps(rows)â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ token_total = sum(...)  â”‚
   â”‚                     â”‚ = 1001000 (å¢åŠ äº†1000)  â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ UPDATE category_details â”‚
   â”‚                     â”‚ SET _rows = '...',      â”‚
   â”‚                     â”‚     token_count_total = '1001000' â”‚
   â”‚                     â”‚ WHERE id = 1            â”‚
   â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                     â”‚                         â”‚
   â”‚ {tokenCountTotal: '1001000',                  â”‚
   â”‚  actualTokenTotal: '800K'}                    â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ æ›´æ–°æ˜¾ç¤ºçš„Tokenç»Ÿè®¡   â”‚                         â”‚
   â”‚ DST: 1001000        â”‚                         â”‚
   â”‚                     â”‚                         â”‚
```

### 4. Excelå¯¼å…¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æµè§ˆå™¨â”‚              â”‚åç«¯  â”‚              â”‚databases/    â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                     â”‚                         â”‚
   â”‚ ç”¨æˆ·ç‚¹å‡»"å¯¼å…¥Excel"  â”‚                         â”‚
   â”‚ é€‰æ‹©æ–‡ä»¶            â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ å‰ç«¯è¯»å–Excelï¼š      â”‚                         â”‚
   â”‚ const wb = XLSX.read(file, {                  â”‚
   â”‚   raw: false,       â”‚                         â”‚
   â”‚   cellText: true    â”‚                         â”‚
   â”‚ })                  â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ è§£ææ•°æ®ï¼š          â”‚                         â”‚
   â”‚ rows = [            â”‚                         â”‚
   â”‚   {key: 1,          â”‚                         â”‚
   â”‚    hdfs_path: '...', â”‚                        â”‚
   â”‚    token_count: '1000000',                    â”‚
   â”‚    actual_usage: '100%'},  // ä¿ç•™æ–‡æœ¬æ ¼å¼   â”‚
   â”‚   ...               â”‚                         â”‚
   â”‚ ]                   â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ POST /.../import    â”‚                         â”‚
   â”‚ {rows: [...]}       â”‚                         â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ è·å–æˆ–åˆ›å»ºCategoryDetail â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ ä¸ºæ¯è¡Œç”Ÿæˆkeyï¼ˆå¦‚æœæ²¡æœ‰ï¼‰â”‚
   â”‚                     â”‚ rows.forEach(r => {     â”‚
   â”‚                     â”‚   if (!r.key)           â”‚
   â”‚                     â”‚     r.key = Date.now()  â”‚
   â”‚                     â”‚ })                      â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ _rows = json.dumps(rows)â”‚
   â”‚                     â”‚ token_total = sum(...)  â”‚
   â”‚                     â”‚ actual_total = sum(...) â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ UPDATE category_details â”‚
   â”‚                     â”‚ SET _rows = '...',      â”‚
   â”‚                     â”‚     token_count_total = 'xxx', â”‚
   â”‚                     â”‚     actual_token_total = 'xxx' â”‚
   â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                     â”‚                         â”‚
   â”‚ {success: true,     â”‚                         â”‚
   â”‚  tokenCountTotal: 'xxx',                      â”‚
   â”‚  actualTokenTotal: 'xxx'}                     â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ message.success()   â”‚                         â”‚
   â”‚ loadData()          â”‚                         â”‚
   â”‚ é‡æ–°åŠ è½½æ•°æ®è¡¨        â”‚                         â”‚
   â”‚                     â”‚                         â”‚
```

### 5. å¯è§†åŒ–æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æµè§ˆå™¨â”‚              â”‚åç«¯  â”‚              â”‚databases/    â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                     â”‚                         â”‚
   â”‚ ç”¨æˆ·è®¿é—®å¯è§†åŒ–é¡µé¢   â”‚                         â”‚
   â”‚ é€‰æ‹©è®¡åˆ’ï¼š72B        â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ GET /api/plans/72B/visualization              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ 1. æŸ¥è¯¢æ‰€æœ‰Stage        â”‚
   â”‚                     â”‚    SELECT * FROM stages â”‚
   â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                     â”‚ [stage1, stage2, ...]   â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ 2. éå†Stageï¼Œè§£æcategories â”‚
   â”‚                     â”‚    categories = json.loads(stage._categories) â”‚
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ 3. æŸ¥è¯¢CategoryDetailè·å–Token â”‚
   â”‚                     â”‚    for cat in categories: â”‚
   â”‚                     â”‚      for subcat in cat.subcategories: â”‚
   â”‚                     â”‚        detail = query(...) â”‚
   â”‚                     â”‚        token += detail.token_count_total â”‚
   â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                     â”‚                         â”‚
   â”‚                     â”‚ 4. èšåˆæ•°æ®ï¼š            â”‚
   â”‚                     â”‚    - stageStats: å„é˜¶æ®µç»Ÿè®¡ â”‚
   â”‚                     â”‚    - categoryStats: ä¸€çº§ç±»åˆ«ç»Ÿè®¡ â”‚
   â”‚                     â”‚    - categoryDistribution: é¥¼å›¾æ•°æ® â”‚
   â”‚                     â”‚    - tokenTrends: ç´¯è®¡è¶‹åŠ¿ â”‚
   â”‚                     â”‚                         â”‚
   â”‚ {                   â”‚                         â”‚
   â”‚   overview: {...},  â”‚                         â”‚
   â”‚   stageStats: [...],â”‚                         â”‚
   â”‚   categoryStats: [...],                       â”‚
   â”‚   categoryDistribution: [...],                â”‚
   â”‚   tokenTrends: [...],                         â”‚
   â”‚   subcategoryStats: [...]                     â”‚
   â”‚ }                   â”‚                         â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ æ¸²æŸ“å›¾è¡¨ï¼š          â”‚                         â”‚
   â”‚ - æ¦‚è§ˆå¡ç‰‡          â”‚                         â”‚
   â”‚ - æŸ±çŠ¶å›¾            â”‚                         â”‚
   â”‚ - é¥¼å›¾              â”‚                         â”‚
   â”‚ - æŠ˜çº¿å›¾            â”‚                         â”‚
   â”‚ - ç»Ÿè®¡è¡¨            â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ è®¾ç½®å®šæ—¶å™¨ï¼š        â”‚                         â”‚
   â”‚ setInterval(() => { â”‚                         â”‚
   â”‚   loadData()        â”‚                         â”‚
   â”‚ }, 30000)           â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ ... 30ç§’å ...      â”‚                         â”‚
   â”‚                     â”‚                         â”‚
   â”‚ GET /api/plans/72B/visualization              â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
   â”‚ ... é‡å¤ä¸Šè¿°æµç¨‹ ... â”‚                         â”‚
   â”‚                     â”‚                         â”‚
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. åˆ†é¡µä¼˜åŒ–

**é—®é¢˜**ï¼š
- 1000æ¡æ•°æ®ä¸€æ¬¡æ€§åŠ è½½å¯¼è‡´ï¼š
  - ç½‘ç»œä¼ è¾“æ—¶é—´é•¿ï¼ˆ1-2ç§’ï¼‰
  - æµè§ˆå™¨æ¸²æŸ“1000è¡ŒDOMèŠ‚ç‚¹ï¼ˆå¡é¡¿ï¼‰
  - å†…å­˜å ç”¨é«˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åç«¯APIæ”¯æŒåˆ†é¡µå‚æ•° `page` å’Œ `page_size`
- å‰ç«¯æ¯æ¬¡åªè¯·æ±‚å½“å‰é¡µæ•°æ®ï¼ˆé»˜è®¤20æ¡ï¼‰
- æ•°æ®é‡å‡å°‘98%ï¼ˆä»1000æ¡åˆ°20æ¡ï¼‰

**æ•ˆæœ**ï¼š
- åŠ è½½æ—¶é—´ï¼š2ç§’ â†’ 0.2ç§’
- å†…å­˜å ç”¨ï¼šå¤§å¹…é™ä½
- ç”¨æˆ·ä½“éªŒï¼šå³æ—¶å“åº”

**ä»£ç ç¤ºä¾‹**ï¼š
```javascript
// å‰ç«¯
const loadData = async (page = 1) => {
  const res = await axios.get(url, {
    params: { page, page_size: 20 }
  })
  setRows(res.data.rows)  // åªæœ‰20æ¡
  setTotal(res.data.total)  // æ€»æ¡æ•°ç”¨äºåˆ†é¡µæ§ä»¶
}

// åç«¯
all_rows = category_data.rows  # æ‰€æœ‰æ•°æ®
total = len(all_rows)
start = (page - 1) * page_size
end = start + page_size
paged_rows = all_rows[start:end]  # åªè¿”å›å½“å‰é¡µ
```

### 2. å•è¡Œæ“ä½œä¼˜åŒ–

**é—®é¢˜**ï¼š
- æ—§ç‰ˆæœ¬ï¼šç¼–è¾‘æˆ–åˆ é™¤æ—¶ä¿å­˜æ•´ä¸ªæ•°æ®é›†
- å¯¼è‡´ï¼š
  - å¹¶å‘å†²çªï¼ˆå¤šç”¨æˆ·åŒæ—¶ç¼–è¾‘ï¼‰
  - æ•°æ®è¦†ç›–ï¼ˆåæäº¤è¦†ç›–å…ˆæäº¤ï¼‰
  - æ€§èƒ½å·®ï¼ˆä¼ è¾“å¤§é‡æ•°æ®ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ–°å¢å•è¡Œæ›´æ–°APIï¼š`PATCH /.../row`
- æ–°å¢æ‰¹é‡åˆ é™¤APIï¼š`DELETE /.../rows`
- æ¯æ¬¡æ“ä½œåªä¼ è¾“ä¿®æ”¹çš„æ•°æ®

**æ•ˆæœ**ï¼š
- é¿å…æ•°æ®è¦†ç›–å†²çª
- æ“ä½œé€Ÿåº¦æå‡ï¼ˆ10msçº§åˆ«ï¼‰
- æ”¯æŒæ›´é«˜å¹¶å‘

### 3. æ•°æ®åº“ç´¢å¼•

```python
class CategoryDetail(PlanBase):
    stage_id = Column(Integer, ForeignKey("stages.id"), index=True)
    category_name = Column(String, index=True)
    subcategory_name = Column(String, index=True)
```

**ç´¢å¼•å­—æ®µ**ï¼š
- `stage_id`ï¼šåŠ é€ŸæŒ‰StageæŸ¥è¯¢
- `category_name`ï¼šåŠ é€ŸæŒ‰ä¸€çº§ç±»åˆ«æŸ¥è¯¢
- `subcategory_name`ï¼šåŠ é€ŸæŒ‰äºŒçº§ç±»åˆ«æŸ¥è¯¢

**æ•ˆæœ**ï¼š
- æŸ¥è¯¢é€Ÿåº¦æå‡10-100å€ï¼ˆå–å†³äºæ•°æ®é‡ï¼‰
- å°¤å…¶åœ¨å¤§æ•°æ®é‡æ—¶æ•ˆæœæ˜¾è‘—

### 4. JSONå­—æ®µä¼˜åŒ–

**ä¼˜åŠ¿**ï¼š
- çµæ´»å­˜å‚¨å¤æ‚æ•°æ®ç»“æ„ï¼ˆæ•°ç»„ã€å¯¹è±¡ï¼‰
- å‡å°‘è¡¨è¿æ¥ï¼ˆJOINï¼‰æ“ä½œ
- ç®€åŒ–æ•°æ®æ¨¡å‹

**æ³¨æ„**ï¼š
- ä¸è¦åœ¨JSONå­—æ®µä¸Šè¿›è¡Œå¤æ‚æŸ¥è¯¢
- é€‚åˆæ•´ä½“è¯»å–ã€æ•´ä½“æ›´æ–°çš„åœºæ™¯
- æœ¬é¡¹ç›®çš„ä½¿ç”¨åœºæ™¯å®Œå…¨é€‚åˆ

### 5. è‡ªåŠ¨åˆ·æ–°ä¼˜åŒ–

**å¯è§†åŒ–é¡µé¢**ï¼š
- æ¯30ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®
- ä½¿ç”¨ `setInterval` + `clearInterval`
- é¿å…å†…å­˜æ³„æ¼

```javascript
useEffect(() => {
  if (selectedPlan) {
    loadVisualizationData(selectedPlan)

    const interval = setInterval(() => {
      loadVisualizationData(selectedPlan)
    }, 30000)

    return () => clearInterval(interval)  // ç»„ä»¶å¸è½½æ—¶æ¸…ç†
  }
}, [selectedPlan])
```

### 6. å·¦ä¾§å¯¼èˆªæ»šåŠ¨ä¼˜åŒ–

**é—®é¢˜**ï¼š
- è®¡åˆ’å’ŒStageå¾ˆå¤šæ—¶ï¼Œå¯¼èˆªæ æ˜¾ç¤ºä¸å…¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
<div style={{
  height: 'calc(100vh - 100px - 70px)',  // å›ºå®šé«˜åº¦
  overflowY: 'auto',   // å‚ç›´æ»šåŠ¨
  overflowX: 'hidden'  // éšè—æ¨ªå‘æ»šåŠ¨
}}>
  <Menu ... />
</div>
```

**æ•ˆæœ**ï¼š
- æ”¯æŒé¼ æ ‡æ»šè½®æ»šåŠ¨
- ç‰ˆæƒä¿¡æ¯ä¸è¢«é®æŒ¡
- æŠ˜å æŒ‰é’®ä½ç½®å›ºå®š

---

## ğŸš€ éƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒ

**åç«¯**ï¼š
```bash
cd backend
conda activate data-version-mgmt
uvicorn main:app --reload --port 5000
```

**å‰ç«¯**ï¼š
```bash
npm run dev
```

**APIæ–‡æ¡£**ï¼š
- è®¿é—® http://localhost:5000/docs æŸ¥çœ‹äº¤äº’å¼APIæ–‡æ¡£

### ç”Ÿäº§ç¯å¢ƒ

**åç«¯éƒ¨ç½²**ï¼š

1. **ä½¿ç”¨Gunicorn + Uvicorn Workers**ï¼š
```bash
# å®‰è£…Gunicorn
pip install gunicorn

# å¯åŠ¨ï¼ˆ4ä¸ªworkerè¿›ç¨‹ï¼‰
gunicorn main:app \
  -w 4 \
  -k uvicorn.workers.UvicornWorker \
  --bind 0.0.0.0:5000 \
  --access-logfile logs/access.log \
  --error-logfile logs/error.log
```

2. **ä½¿ç”¨Supervisorç®¡ç†è¿›ç¨‹**ï¼š
```ini
[program:data-mgmt-backend]
directory=/path/to/backend
command=/path/to/gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:5000
autostart=true
autorestart=true
stderr_logfile=/var/log/data-mgmt-backend.err.log
stdout_logfile=/var/log/data-mgmt-backend.out.log
```

**å‰ç«¯éƒ¨ç½²**ï¼š

1. **æ„å»ºç”Ÿäº§ç‰ˆæœ¬**ï¼š
```bash
npm run build
# ç”Ÿæˆ dist/ ç›®å½•
```

2. **ä½¿ç”¨Nginxæ‰˜ç®¡é™æ€æ–‡ä»¶**ï¼š
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/dist;
        try_files $uri $uri/ /index.html;
    }

    # åå‘ä»£ç†åç«¯API
    location /api {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### æ•°æ®åº“å¤‡ä»½

**å®šæœŸå¤‡ä»½è„šæœ¬**ï¼š
```bash
#!/bin/bash
# backup.sh

BACKUP_DIR="/backups"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_PATH="$BACKUP_DIR/backup_$DATE"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_PATH

# å¤‡ä»½ä¸»æ•°æ®åº“
cp backend/main.db $BACKUP_PATH/

# å¤‡ä»½æ‰€æœ‰è®¡åˆ’æ•°æ®åº“
cp backend/databases/*.db $BACKUP_PATH/

# å‹ç¼©
cd $BACKUP_DIR
tar -czf backup_$DATE.tar.gz backup_$DATE
rm -rf backup_$DATE

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "backup_*.tar.gz" -mtime +7 -delete

echo "Backup completed: $BACKUP_PATH.tar.gz"
```

**è®¾ç½®Cronå®šæ—¶ä»»åŠ¡**ï¼š
```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /path/to/backup.sh
```

### ç›‘æ§å»ºè®®

1. **æ—¥å¿—ç›‘æ§**ï¼š
   - ä½¿ç”¨ELK Stackï¼ˆElasticsearch + Logstash + Kibanaï¼‰
   - æˆ–ä½¿ç”¨ç®€å•çš„æ—¥å¿—è½®è½¬ï¼šlogrotate

2. **æ€§èƒ½ç›‘æ§**ï¼š
   - ä½¿ç”¨Prometheus + Grafana
   - ç›‘æ§æŒ‡æ ‡ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€è¯·æ±‚é‡ã€å“åº”æ—¶é—´

3. **å¥åº·æ£€æŸ¥**ï¼š
```python
@app.get("/health")
def health_check():
    return {"status": "ok"}
```

---

## ğŸ”§ æ‰©å±•æ€§è®¾è®¡

### æ·»åŠ æ–°åŠŸèƒ½

#### 1. æ·»åŠ æ–°é¡µé¢

```javascript
// src/pages/NewPage.jsx
export default function NewPage() {
  return <div>New Page</div>
}

// src/App.jsx
import NewPage from './pages/NewPage'

<Routes>
  <Route path="/new-page" element={<NewPage />} />
</Routes>
```

#### 2. æ·»åŠ æ–°API

```python
# backend/main.py
@app.get("/api/new-endpoint")
def new_endpoint():
    return {"data": "..."}
```

#### 3. ä¿®æ”¹æ•°æ®æ¨¡å‹

```python
# backend/models.py
class Stage(PlanBase):
    # æ·»åŠ æ–°å­—æ®µ
    new_field = Column(String, default="")

# æ‰‹åŠ¨è¿ç§»ï¼ˆSQLiteæ²¡æœ‰è‡ªåŠ¨è¿ç§»ï¼‰
# æ–¹æ³•1ï¼šåˆ é™¤æ—§æ•°æ®åº“ï¼Œé‡æ–°åˆ›å»ºï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
# æ–¹æ³•2ï¼šä½¿ç”¨SQL ALTER TABLEè¯­å¥
```

### æ”¯æŒå…¶ä»–æ•°æ®åº“

**PostgreSQL**ï¼š
```python
# backend/database.py
MAIN_DATABASE_URL = "postgresql://user:password@localhost/maindb"
```

**MySQL**ï¼š
```python
MAIN_DATABASE_URL = "mysql+pymysql://user:password@localhost/maindb"
```

**æ³¨æ„**ï¼šéœ€è¦å®‰è£…ç›¸åº”çš„é©±åŠ¨ï¼š
```bash
pip install psycopg2-binary  # PostgreSQL
pip install pymysql  # MySQL
```

### æ¨ªå‘æ‰©å±•

#### 1. ç¼“å­˜ä¼˜åŒ–

ä½¿ç”¨Redisç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®ï¼š
```python
import redis

r = redis.Redis(host='localhost', port=6379)

@app.get("/api/plans")
def get_plans():
    # å…ˆæŸ¥ç¼“å­˜
    cached = r.get('plans')
    if cached:
        return json.loads(cached)

    # æŸ¥æ•°æ®åº“
    plans = db.query(models.Plan).all()

    # å†™å…¥ç¼“å­˜
    r.setex('plans', 300, json.dumps(plans))  # 5åˆ†é’Ÿè¿‡æœŸ

    return plans
```

#### 2. æ¶ˆæ¯é˜Ÿåˆ—

ä½¿ç”¨Celeryå¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚å¤§é‡æ•°æ®å¯¼å…¥ï¼‰ï¼š
```python
from celery import Celery

celery_app = Celery('tasks', broker='redis://localhost:6379/0')

@celery_app.task
def import_large_excel(file_path, plan_name):
    # å¼‚æ­¥å¤„ç†Excelå¯¼å…¥
    ...

@app.post("/api/import-async")
def import_async(file: UploadFile):
    # ä¿å­˜æ–‡ä»¶
    file_path = save_file(file)

    # æäº¤å¼‚æ­¥ä»»åŠ¡
    task = import_large_excel.delay(file_path, plan_name)

    return {"task_id": task.id}
```

#### 3. è´Ÿè½½å‡è¡¡

ä½¿ç”¨Nginxè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼š
```nginx
upstream backend {
    server 127.0.0.1:5000;
    server 127.0.0.1:5001;
    server 127.0.0.1:5002;
}

server {
    location /api {
        proxy_pass http://backend;
    }
}
```

---

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

**Python**ï¼š
- éµå¾ªPEP 8è§„èŒƒ
- ä½¿ç”¨ç±»å‹æç¤ºï¼ˆType Hintsï¼‰
- å‡½æ•°å’Œç±»æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸²

**JavaScript**ï¼š
- ä½¿ç”¨ES6+è¯­æ³•
- å‡½æ•°å¼ç»„ä»¶ + Hooks
- é©¼å³°å‘½åæ³•

### Gitå·¥ä½œæµ

```bash
# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature

# å¼€å‘ã€æµ‹è¯•

# æäº¤
git add .
git commit -m "feat: add new feature"

# åˆå¹¶åˆ°main
git checkout main
git merge feature/new-feature
```

### æäº¤ä¿¡æ¯è§„èŒƒ

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
refactor: é‡æ„
perf: æ€§èƒ½ä¼˜åŒ–
test: æµ‹è¯•
chore: æ„å»ºå·¥å…·æˆ–è¾…åŠ©å·¥å…·
```

---

## ğŸ“š å¸¸è§é—®é¢˜

### ä¸ºä»€ä¹ˆä½¿ç”¨SQLiteè€Œä¸æ˜¯PostgreSQLæˆ–MySQLï¼Ÿ

**ä¼˜åŠ¿**ï¼š
- é›¶é…ç½®ï¼šæ— éœ€å®‰è£…æ•°æ®åº“æœåŠ¡å™¨
- å•æ–‡ä»¶ï¼šæ˜“äºå¤‡ä»½ã€è¿ç§»ã€ç‰ˆæœ¬æ§åˆ¶
- é«˜æ€§èƒ½ï¼šå¯¹äºä¸­å°å‹æ•°æ®é›†ï¼ˆ<10ä¸‡æ¡ï¼‰æ€§èƒ½ä¼˜ç§€
- è·¨å¹³å°ï¼šWindowsã€Linuxã€Macå‡å¯è¿è¡Œ

**åŠ£åŠ¿**ï¼š
- ä¸æ”¯æŒå¹¶å‘å†™å…¥ï¼ˆæœ¬é¡¹ç›®è¯»å¤šå†™å°‘ï¼Œå½±å“ä¸å¤§ï¼‰
- ä¸æ”¯æŒå¤æ‚çš„æƒé™ç®¡ç†
- å•æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆç†è®ºä¸Š2TBï¼Œå®é™…å»ºè®®<100GBï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- æœ¬é¡¹ç›®çš„æ•°æ®é‡å’Œå¹¶å‘é‡å®Œå…¨é€‚åˆSQLite
- å¦‚æœæœªæ¥éœ€è¦é«˜å¹¶å‘æˆ–å¤§æ•°æ®é‡ï¼Œå¯è½»æ¾è¿ç§»åˆ°PostgreSQL

### ä¸ºä»€ä¹ˆä½¿ç”¨JSONå­—æ®µè€Œä¸æ˜¯å…³ç³»è¡¨ï¼Ÿ

**JSONå­—æ®µ**ï¼š
- ä¼˜åŠ¿ï¼šçµæ´»ã€å‡å°‘JOINã€ç®€åŒ–æ¨¡å‹
- åŠ£åŠ¿ï¼šä¸èƒ½åœ¨JSONå†…éƒ¨æŸ¥è¯¢å’Œç´¢å¼•

**æœ¬é¡¹ç›®åœºæ™¯**ï¼š
- `Stage.categories`ï¼šç±»åˆ«ç»“æ„æ˜¯æ•´ä½“è¯»å–ã€æ•´ä½“æ›´æ–°
- `CategoryDetail.rows`ï¼šæ•°æ®è¡Œæ˜¯æ‰¹é‡è¯»å–ã€å•è¡Œæ›´æ–°
- **å®Œå…¨é€‚åˆJSONå­—æ®µ**

**ä½•æ—¶ä½¿ç”¨å…³ç³»è¡¨**ï¼š
- éœ€è¦å¤æ‚æŸ¥è¯¢ï¼ˆå¦‚ï¼šæŸ¥æ‰¾token_count > 1000çš„æ‰€æœ‰è¡Œï¼‰
- éœ€è¦å¤–é”®çº¦æŸ
- éœ€è¦ç‹¬ç«‹çš„å¢åˆ æ”¹æŸ¥

### å¦‚ä½•æ‰©å±•æ”¯æŒæ›´å¤šStageï¼Ÿ

**å½“å‰è®¾è®¡å·²æ”¯æŒä»»æ„æ•°é‡çš„Stage**ï¼š
- æ²¡æœ‰ç¡¬ç¼–ç çš„Stageæ•°é‡é™åˆ¶
- åŠ¨æ€åˆ›å»ºStage
- å·¦ä¾§å¯¼èˆªè‡ªåŠ¨æ›´æ–°

**å¦‚æœStageéå¸¸å¤šï¼ˆ>100ä¸ªï¼‰**ï¼š
- è€ƒè™‘ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆreact-windowï¼‰
- æˆ–æ·»åŠ æœç´¢/è¿‡æ»¤åŠŸèƒ½

### å¦‚ä½•æ”¯æŒå¤šç”¨æˆ·åä½œï¼Ÿ

**å½“å‰æ”¯æŒ**ï¼š
- å¤šç”¨æˆ·åŒæ—¶æŸ¥çœ‹ï¼ˆæ— é™åˆ¶ï¼‰
- ç®¡ç†å‘˜æƒé™æ§åˆ¶
- å•è¡Œæ“ä½œé¿å…æ•°æ®è¦†ç›–

**è¿›ä¸€æ­¥å¢å¼º**ï¼š
- æ·»åŠ WebSocketå®ç°å®æ—¶åŒæ­¥
- æ·»åŠ æ“ä½œæ—¥å¿—ï¼ˆè°åœ¨ä»€ä¹ˆæ—¶å€™ä¿®æ”¹äº†ä»€ä¹ˆï¼‰
- æ·»åŠ æ•°æ®é”ï¼ˆæ‚²è§‚é”æˆ–ä¹è§‚é”ï¼‰

---

## ğŸ“– å‚è€ƒèµ„æ–™

**åç«¯**ï¼š
- [FastAPIå®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [SQLAlchemyå®˜æ–¹æ–‡æ¡£](https://www.sqlalchemy.org/)
- [JWTå®˜æ–¹ç½‘ç«™](https://jwt.io/)

**å‰ç«¯**ï¼š
- [Reactå®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [Ant Designå®˜æ–¹æ–‡æ¡£](https://ant.design/)
- [Rechartså®˜æ–¹æ–‡æ¡£](https://recharts.org/)
- [SheetJSæ–‡æ¡£](https://docs.sheetjs.com/)

**å…¶ä»–**ï¼š
- [Viteå®˜æ–¹æ–‡æ¡£](https://vitejs.dev/)
- [SQLiteå®˜æ–¹æ–‡æ¡£](https://www.sqlite.org/docs.html)

---

**æœ€åæ›´æ–°**ï¼š2025-12-03
**ç‰ˆæœ¬**ï¼šv1.0
**å¼€å‘å•ä½**ï¼šå¤§æ¨¡å‹æ•°æ®æŠ€æœ¯å®éªŒå®¤
**æ–‡æ¡£ç»´æŠ¤**ï¼šè¯·æ ¹æ®ä»£ç å˜æ›´åŠæ—¶æ›´æ–°æœ¬æ–‡æ¡£
